<div class="export-tools" style="margin: 10px 0; padding: 10px; background: #2d2d2d; border-radius: 5px;">
  <h3 style="margin: 0 0 10px 0; color: #00ff00; font-size: 1em;">Export Tools</h3>
  <button id="export-bookmarks" class="btn" style="margin-right: 10px;" 
          aria-label="Export visible portals as browser bookmarks">
    üìÅ Export Bookmarks
  </button>
  <button id="export-csv" class="btn" style="margin-right: 10px;"
          aria-label="Export visible portals as CSV file">
    üìä Export CSV
  </button>
  <button id="copy-urls" class="btn"
          aria-label="Copy all visible portal URLs to clipboard">
    üìã Copy URLs
  </button>
  <div id="export-status" role="status" aria-live="polite" style="margin-top: 5px; font-size: 0.9em; color: #00ff00;"></div>
</div>

<script type="text/javascript">
  // Export functionality
  function getVisiblePortals() {
    const visiblePortals = [];
    const portalGroups = document.querySelectorAll('.portal-group:not([hidden])');
    
    portalGroups.forEach(group => {
      const groupName = group.querySelector('h2').textContent;
      const portals = group.querySelectorAll('.portal:not([hidden])');
      
      portals.forEach(portal => {
        const nameElement = portal.querySelector('.portal-title');
        const urlElement = portal.querySelector('.portal-url a');
        if (nameElement && urlElement) {
          visiblePortals.push({
            name: nameElement.textContent.trim(),
            url: urlElement.href,
            group: groupName
          });
        }
      });
    });
    
    return visiblePortals;
  }

  // Export as bookmarks HTML file
  document.getElementById('export-bookmarks').addEventListener('click', function() {
    const portals = getVisiblePortals();
    const statusDiv = document.getElementById('export-status');
    
    if (portals.length === 0) {
      statusDiv.textContent = 'No portals to export';
      return;
    }
    
    let html = '<!DOCTYPE NETSCAPE-Bookmark-file-1>\n<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">\n<TITLE>Bookmarks</TITLE>\n<H1>Bookmarks</H1>\n<DL><p>\n';
    html += '<DT><H3>MSPortals.io</H3>\n<DL><p>\n';
    
    const groups = {};
    portals.forEach(portal => {
      if (!groups[portal.group]) groups[portal.group] = [];
      groups[portal.group].push(portal);
    });
    
    Object.keys(groups).forEach(groupName => {
      html += `<DT><H3>${groupName}</H3>\n<DL><p>\n`;
      groups[groupName].forEach(portal => {
        html += `<DT><A HREF="${portal.url}">${portal.name}</A>\n`;
      });
      html += '</DL><p>\n';
    });
    
    html += '</DL><p>\n</DL><p>';
    
    const blob = new Blob([html], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'msportals-bookmarks.html';
    a.click();
    URL.revokeObjectURL(url);
    
    statusDiv.textContent = `Exported ${portals.length} portals as bookmarks`;
    setTimeout(() => statusDiv.textContent = '', 3000);
  });

  // Export as CSV
  document.getElementById('export-csv').addEventListener('click', function() {
    const portals = getVisiblePortals();
    const statusDiv = document.getElementById('export-status');
    
    if (portals.length === 0) {
      statusDiv.textContent = 'No portals to export';
      return;
    }
    
    let csv = 'Portal Name,URL,Category\n';
    portals.forEach(portal => {
      const name = portal.name.replace(/"/g, '""');
      csv += `"${name}","${portal.url}","${portal.group}"\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'msportals.csv';
    a.click();
    URL.revokeObjectURL(url);
    
    statusDiv.textContent = `Exported ${portals.length} portals as CSV`;
    setTimeout(() => statusDiv.textContent = '', 3000);
  });

  // Copy URLs to clipboard
  document.getElementById('copy-urls').addEventListener('click', async function() {
    const portals = getVisiblePortals();
    const statusDiv = document.getElementById('export-status');
    
    if (portals.length === 0) {
      statusDiv.textContent = 'No portals to copy';
      return;
    }
    
    const urls = portals.map(p => p.url).join('\n');
    
    try {
      await navigator.clipboard.writeText(urls);
      statusDiv.textContent = `Copied ${portals.length} portal URLs to clipboard`;
    } catch (err) {
      // Fallback for older browsers
      const textArea = document.createElement('textarea');
      textArea.value = urls;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      statusDiv.textContent = `Copied ${portals.length} portal URLs to clipboard`;
    }
    
    setTimeout(() => statusDiv.textContent = '', 3000);
  });
</script>